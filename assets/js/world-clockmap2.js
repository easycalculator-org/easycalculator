 var iana_timezone_colors = { "Africa\/Abidjan": "red", "Africa\/Accra": "red", "Africa\/Addis_Ababa": "green", "Africa\/Algiers": "orange", "Africa\/Asmara": "green", "Africa\/Bamako": "red", "Africa\/Bangui": "orange", "Africa\/Banjul": "red", "Africa\/Bissau": "red", "Africa\/Blantyre": "yellow", "Africa\/Brazzaville": "orange", "Africa\/Bujumbura": "yellow", "Africa\/Cairo": "green", "Africa\/Casablanca": "orange", "Africa\/Ceuta": "yellow", "Africa\/Conakry": "red", "Africa\/Dakar": "red", "Africa\/Dar_es_Salaam": "green", "Africa\/Djibouti": "green", "Africa\/Douala": "orange", "Africa\/El_Aaiun": "orange", "Africa\/Freetown": "red", "Africa\/Gaborone": "yellow", "Africa\/Harare": "yellow", "Africa\/Johannesburg": "yellow", "Africa\/Juba": "yellow", "Africa\/Kampala": "green", "Africa\/Khartoum": "yellow", "Africa\/Kigali": "yellow", "Africa\/Kinshasa": "orange", "Africa\/Lagos": "orange", "Africa\/Libreville": "orange", "Africa\/Lome": "red", "Africa\/Luanda": "orange", "Africa\/Lubumbashi": "yellow", "Africa\/Lusaka": "yellow", "Africa\/Malabo": "orange", "Africa\/Maputo": "yellow", "Africa\/Maseru": "yellow", "Africa\/Mbabane": "yellow", "Africa\/Mogadishu": "green", "Africa\/Monrovia": "red", "Africa\/Nairobi": "green", "Africa\/Ndjamena": "orange", "Africa\/Niamey": "orange", "Africa\/Nouakchott": "red", "Africa\/Ouagadougou": "red", "Africa\/Porto-Novo": "orange", "Africa\/Sao_Tome": "red", "Africa\/Tripoli": "yellow", "Africa\/Tunis": "orange", "Africa\/Windhoek": "yellow", "America\/Adak": "yellow", "America\/Anchorage": "orange", "America\/Anguilla": "cyan", "America\/Antigua": "cyan", "America\/Araguaina": "green", "America\/Argentina\/Buenos_Aires": "green", "America\/Argentina\/Catamarca": "green", "America\/Argentina\/Cordoba": "green", "America\/Argentina\/Jujuy": "green", "America\/Argentina\/La_Rioja": "green", "America\/Argentina\/Mendoza": "green", "America\/Argentina\/Rio_Gallegos": "green", "America\/Argentina\/Salta": "green", "America\/Argentina\/San_Juan": "green", "America\/Argentina\/San_Luis": "green", "America\/Argentina\/Tucuman": "green", "America\/Argentina\/Ushuaia": "green", "America\/Aruba": "cyan", "America\/Asuncion": "cyan", "America\/Atikokan": "blue", "America\/Bahia": "green", "America\/Bahia_Banderas": "violet", "America\/Barbados": "cyan", "America\/Belem": "green", "America\/Belize": "violet", "America\/Blanc-Sablon": "cyan", "America\/Boa_Vista": "cyan", "America\/Bogota": "blue", "America\/Boise": "violet", "America\/Cambridge_Bay": "violet", "America\/Campo_Grande": "cyan", "America\/Cancun": "blue", "America\/Caracas": "cyan", "America\/Cayenne": "green", "America\/Cayman": "blue", "America\/Chicago": "blue", "America\/Chihuahua": "violet", "America\/Ciudad_Juarez": "violet", "America\/Costa_Rica": "violet", "America\/Creston": "red", "America\/Cuiaba": "cyan", "America\/Curacao": "cyan", "America\/Danmarkshavn": "red", "America\/Dawson": "red", "America\/Dawson_Creek": "red", "America\/Denver": "violet", "America\/Detroit": "cyan", "America\/Dominica": "cyan", "America\/Edmonton": "violet", "America\/Eirunepe": "blue", "America\/El_Salvador": "violet", "America\/Fort_Nelson": "red", "America\/Fortaleza": "green", "America\/Glace_Bay": "green", "America\/Goose_Bay": "green", "America\/Grand_Turk": "cyan", "America\/Grenada": "cyan", "America\/Guadeloupe": "cyan", "America\/Guatemala": "violet", "America\/Guayaquil": "blue", "America\/Guyana": "cyan", "America\/Halifax": "green", "America\/Havana": "cyan", "America\/Hermosillo": "red", "America\/Indiana\/Indianapolis": "cyan", "America\/Indiana\/Knox": "blue", "America\/Indiana\/Marengo": "cyan", "America\/Indiana\/Petersburg": "cyan", "America\/Indiana\/Tell_City": "blue", "America\/Indiana\/Vevay": "cyan", "America\/Indiana\/Vincennes": "cyan", "America\/Indiana\/Winamac": "cyan", "America\/Inuvik": "violet", "America\/Iqaluit": "cyan", "America\/Jamaica": "blue", "America\/Juneau": "orange", "America\/Kentucky\/Louisville": "cyan", "America\/Kentucky\/Monticello": "cyan", "America\/Kralendijk": "cyan", "America\/La_Paz": "cyan", "America\/Lima": "blue", "America\/Los_Angeles": "red", "America\/Lower_Princes": "cyan", "America\/Maceio": "green", "America\/Managua": "violet", "America\/Manaus": "cyan", "America\/Marigot": "cyan", "America\/Martinique": "cyan", "America\/Matamoros": "blue", "America\/Mazatlan": "red", "America\/Menominee": "blue", "America\/Merida": "violet", "America\/Metlakatla": "orange", "America\/Mexico_City": "violet", "America\/Miquelon": "yellow", "America\/Moncton": "green", "America\/Monterrey": "violet", "America\/Montevideo": "green", "America\/Montserrat": "cyan", "America\/Nassau": "cyan", "America\/New_York": "cyan", "America\/Nome": "orange", "America\/Noronha": "yellow", "America\/North_Dakota\/Beulah": "blue", "America\/North_Dakota\/Center": "blue", "America\/North_Dakota\/New_Salem": "blue", "America\/Nuuk": "orange", "America\/Ojinaga": "blue", "America\/Panama": "blue", "America\/Paramaribo": "green", "America\/Phoenix": "red", "America\/Port-au-Prince": "cyan", "America\/Port_of_Spain": "cyan", "America\/Porto_Velho": "cyan", "America\/Puerto_Rico": "cyan", "America\/Punta_Arenas": "green", "America\/Rankin_Inlet": "blue", "America\/Recife": "green", "America\/Regina": "violet", "America\/Resolute": "blue", "America\/Rio_Branco": "blue", "America\/Santarem": "green", "America\/Santiago": "cyan", "America\/Santo_Domingo": "cyan", "America\/Sao_Paulo": "green", "America\/Scoresbysund": "orange", "America\/Sitka": "orange", "America\/St_Barthelemy": "cyan", "America\/St_Johns": "wheat", "America\/St_Kitts": "cyan", "America\/St_Lucia": "cyan", "America\/St_Thomas": "cyan", "America\/St_Vincent": "cyan", "America\/Swift_Current": "violet", "America\/Tegucigalpa": "violet", "America\/Thule": "green", "America\/Tijuana": "red", "America\/Toronto": "cyan", "America\/Tortola": "cyan", "America\/Vancouver": "red", "America\/Whitehorse": "red", "America\/Winnipeg": "blue", "America\/Yakutat": "orange", "Antarctica\/Casey": "orange", "Antarctica\/Davis": "red", "Antarctica\/DumontDUrville": "green", "Antarctica\/Macquarie": "green", "Antarctica\/Mawson": "blue", "Antarctica\/McMurdo": "blue", "Antarctica\/Palmer": "green", "Antarctica\/Rothera": "green", "Antarctica\/Syowa": "green", "Antarctica\/Troll": "yellow", "Antarctica\/Vostok": "blue", "Arctic\/Longyearbyen": "yellow", "Asia\/Aden": "green", "Asia\/Almaty": "blue", "Asia\/Amman": "green", "Asia\/Anadyr": "blue", "Asia\/Aqtau": "blue", "Asia\/Aqtobe": "blue", "Asia\/Ashgabat": "blue", "Asia\/Atyrau": "blue", "Asia\/Baghdad": "green", "Asia\/Bahrain": "green", "Asia\/Baku": "cyan", "Asia\/Bangkok": "red", "Asia\/Barnaul": "red", "Asia\/Beirut": "green", "Asia\/Bishkek": "violet", "Asia\/Brunei": "orange", "Asia\/Chita": "yellow", "Asia\/Choibalsan": "orange", "Asia\/Colombo": "wheat", "Asia\/Damascus": "green", "Asia\/Dhaka": "violet", "Asia\/Dili": "yellow", "Asia\/Dubai": "cyan", "Asia\/Dushanbe": "blue", "Asia\/Famagusta": "green", "Asia\/Gaza": "green", "Asia\/Hebron": "green", "Asia\/Ho_Chi_Minh": "red", "Asia\/Hong_Kong": "orange", "Asia\/Hovd": "red", "Asia\/Irkutsk": "orange", "Asia\/Jakarta": "red", "Asia\/Jayapura": "yellow", "Asia\/Jerusalem": "green", "Asia\/Kabul": "wheat", "Asia\/Kamchatka": "blue", "Asia\/Karachi": "blue", "Asia\/Kathmandu": "wheat", "Asia\/Khandyga": "yellow", "Asia\/Kolkata": "wheat", "Asia\/Krasnoyarsk": "red", "Asia\/Kuala_Lumpur": "orange", "Asia\/Kuching": "orange", "Asia\/Kuwait": "green", "Asia\/Macau": "orange", "Asia\/Magadan": "cyan", "Asia\/Makassar": "orange", "Asia\/Manila": "orange", "Asia\/Muscat": "cyan", "Asia\/Nicosia": "green", "Asia\/Novokuznetsk": "red", "Asia\/Novosibirsk": "red", "Asia\/Omsk": "violet", "Asia\/Oral": "blue", "Asia\/Phnom_Penh": "red", "Asia\/Pontianak": "red", "Asia\/Pyongyang": "yellow", "Asia\/Qatar": "green", "Asia\/Qostanay": "blue", "Asia\/Qyzylorda": "blue", "Asia\/Riyadh": "green", "Asia\/Sakhalin": "cyan", "Asia\/Samarkand": "blue", "Asia\/Seoul": "yellow", "Asia\/Shanghai": "orange", "Asia\/Singapore": "orange", "Asia\/Srednekolymsk": "cyan", "Asia\/Taipei": "orange", "Asia\/Tashkent": "blue", "Asia\/Tbilisi": "cyan", "Asia\/Tehran": "wheat", "Asia\/Thimphu": "violet", "Asia\/Tokyo": "yellow", "Asia\/Tomsk": "red", "Asia\/Ulaanbaatar": "orange", "Asia\/Urumqi": "orange", "Asia\/Ust-Nera": "green", "Asia\/Vientiane": "red", "Asia\/Vladivostok": "green", "Asia\/Yakutsk": "yellow", "Asia\/Yangon": "wheat", "Asia\/Yekaterinburg": "blue", "Asia\/Yerevan": "cyan", "Atlantic\/Azores": "red", "Atlantic\/Bermuda": "green", "Atlantic\/Canary": "orange", "Atlantic\/Cape_Verde": "orange", "Atlantic\/Faroe": "orange", "Atlantic\/Madeira": "orange", "Atlantic\/Reykjavik": "red", "Atlantic\/South_Georgia": "yellow", "Atlantic\/St_Helena": "red", "Atlantic\/Stanley": "green", "Australia\/Adelaide": "wheat", "Australia\/Brisbane": "green", "Australia\/Broken_Hill": "wheat", "Australia\/Darwin": "wheat", "Australia\/Eucla": "wheat", "Australia\/Hobart": "green", "Australia\/Lindeman": "green", "Australia\/Lord_Howe": "wheat", "Australia\/Melbourne": "green", "Australia\/Perth": "orange", "Australia\/Sydney": "green", "Europe\/Amsterdam": "yellow", "Europe\/Andorra": "yellow", "Europe\/Astrakhan": "cyan", "Europe\/Athens": "green", "Europe\/Belgrade": "yellow", "Europe\/Berlin": "yellow", "Europe\/Bratislava": "yellow", "Europe\/Brussels": "yellow", "Europe\/Bucharest": "green", "Europe\/Budapest": "yellow", "Europe\/Busingen": "yellow", "Europe\/Chisinau": "green", "Europe\/Copenhagen": "yellow", "Europe\/Dublin": "orange", "Europe\/Gibraltar": "yellow", "Europe\/Guernsey": "orange", "Europe\/Helsinki": "green", "Europe\/Isle_of_Man": "orange", "Europe\/Istanbul": "green", "Europe\/Jersey": "orange", "Europe\/Kaliningrad": "yellow", "Europe\/Kirov": "green", "Europe\/Kyiv": "green", "Europe\/Lisbon": "orange", "Europe\/Ljubljana": "yellow", "Europe\/London": "orange", "Europe\/Luxembourg": "yellow", "Europe\/Madrid": "yellow", "Europe\/Malta": "yellow", "Europe\/Mariehamn": "green", "Europe\/Minsk": "green", "Europe\/Monaco": "yellow", "Europe\/Moscow": "green", "Europe\/Oslo": "yellow", "Europe\/Paris": "yellow", "Europe\/Podgorica": "yellow", "Europe\/Prague": "yellow", "Europe\/Riga": "green", "Europe\/Rome": "yellow", "Europe\/Samara": "cyan", "Europe\/San_Marino": "yellow", "Europe\/Sarajevo": "yellow", "Europe\/Saratov": "cyan", "Europe\/Simferopol": "green", "Europe\/Skopje": "yellow", "Europe\/Sofia": "green", "Europe\/Stockholm": "yellow", "Europe\/Tallinn": "green", "Europe\/Tirane": "yellow", "Europe\/Ulyanovsk": "cyan", "Europe\/Vaduz": "yellow", "Europe\/Vatican": "yellow", "Europe\/Vienna": "yellow", "Europe\/Vilnius": "green", "Europe\/Volgograd": "green", "Europe\/Warsaw": "yellow", "Europe\/Zagreb": "yellow", "Europe\/Zurich": "yellow", "Indian\/Antananarivo": "green", "Indian\/Chagos": "violet", "Indian\/Christmas": "red", "Indian\/Cocos": "wheat", "Indian\/Comoro": "green", "Indian\/Kerguelen": "blue", "Indian\/Mahe": "cyan", "Indian\/Maldives": "blue", "Indian\/Mauritius": "cyan", "Indian\/Mayotte": "green", "Indian\/Reunion": "cyan", "Pacific\/Apia": "violet", "Pacific\/Auckland": "blue", "Pacific\/Bougainville": "cyan", "Pacific\/Chatham": "wheat", "Pacific\/Chuuk": "green", "Pacific\/Easter": "violet", "Pacific\/Efate": "cyan", "Pacific\/Fakaofo": "violet", "Pacific\/Fiji": "blue", "Pacific\/Funafuti": "blue", "Pacific\/Galapagos": "violet", "Pacific\/Gambier": "yellow", "Pacific\/Guadalcanal": "cyan", "Pacific\/Guam": "green", "Pacific\/Honolulu": "green", "Pacific\/Kanton": "violet", "Pacific\/Kiritimati": "red", "Pacific\/Kosrae": "cyan", "Pacific\/Kwajalein": "blue", "Pacific\/Majuro": "blue", "Pacific\/Marquesas": "wheat", "Pacific\/Midway": "cyan", "Pacific\/Nauru": "blue", "Pacific\/Niue": "cyan", "Pacific\/Norfolk": "cyan", "Pacific\/Noumea": "cyan", "Pacific\/Pago_Pago": "cyan", "Pacific\/Palau": "yellow", "Pacific\/Pitcairn": "orange", "Pacific\/Pohnpei": "cyan", "Pacific\/Port_Moresby": "green", "Pacific\/Rarotonga": "green", "Pacific\/Saipan": "green", "Pacific\/Tahiti": "green", "Pacific\/Tarawa": "blue", "Pacific\/Tongatapu": "violet", "Pacific\/Wake": "blue", "Pacific\/Wallis": "blue", "UTC": "red", "Etc\/GMT": "#f8f8f8", "Etc\/GMT+1": "#f8f8f8", "Etc\/GMT+10": "#f8f8f8", "Etc\/GMT+11": "#f8f8f8", "Etc\/GMT+12": "#f8f8f8", "Etc\/GMT+2": "#f8f8f8", "Etc\/GMT+3": "#f8f8f8", "Etc\/GMT+4": "#f8f8f8", "Etc\/GMT+5": "#f8f8f8", "Etc\/GMT+6": "#f8f8f8", "Etc\/GMT+7": "#f8f8f8", "Etc\/GMT+8": "#f8f8f8", "Etc\/GMT+9": "#f8f8f8", "Etc\/GMT-1": "#f8f8f8", "Etc\/GMT-10": "#f8f8f8", "Etc\/GMT-11": "#f8f8f8", "Etc\/GMT-12": "#f8f8f8", "Etc\/GMT-13": "#f8f8f8", "Etc\/GMT-14": "#f8f8f8", "Etc\/GMT-2": "#f8f8f8", "Etc\/GMT-3": "#f8f8f8", "Etc\/GMT-4": "#f8f8f8", "Etc\/GMT-5": "#f8f8f8", "Etc\/GMT-6": "#f8f8f8", "Etc\/GMT-7": "#f8f8f8", "Etc\/GMT-8": "#f8f8f8", "Etc\/GMT-9": "#f8f8f8" };
            var utc_offset_colors = { "-11": "cyan", "-10": "green", "-9": "yellow", "-8": "orange", "-7": "red", "-6": "violet", "-5": "blue", "-4": "cyan", "-3": "green", "-2": "yellow", "-1": "orange", "UTC": "red", "+1": "orange", "+2": "yellow", "+3": "green", "+4": "cyan", "+5": "blue", "+6": "violet", "+7": "red", "+8": "orange", "+9": "yellow", "+10": "green", "+11": "cyan", "+12": "blue" };
            var timer_interval = null;
            jinjaVars = {
                ...jinjaVars,
                lang: "en"
            };
            var newLangs = ["da"];
            var mapStyleUrl = newLangs.includes(jinjaVars.lang) ?
                "/map/osm-bright-" + jinjaVars.lang + "/style.json" :
                "https://m.24timezones.com/styles/osm-bright-" + jinjaVars.lang + "/style.json";
            function debounce(func, wait, immediate) {
                var timeout;
                return function () {
                    var context = this, args = arguments;
                    var later = function () {
                        timeout = null;
                        if (!immediate) func.apply(context, args);
                    };
                    var callNow = immediate && !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    if (callNow) func.apply(context, args);
                };
            }
            function hasOwnProp(a, b) {
                return Object.prototype.hasOwnProperty.call(a, b);
            }
            function extend(a, b) {
                for (var i in b) {
                    if (hasOwnProp(b, i)) {
                        a[i] = b[i];
                    }
                }
                if (hasOwnProp(b, 'toString')) {
                    a.toString = b.toString;
                }
                if (hasOwnProp(b, 'valueOf')) {
                    a.valueOf = b.valueOf;
                }
                return a;
            }
            function SearchCityPlugin(options) {
            }
            SearchCityPlugin.prototype = {
                options: {
                },
                onAdd: function (map) {
                    this._map = map;
                    this._onChange = this._onChange.bind(this);
                    this._onKeyDown = this._onKeyDown.bind(this);
                    this._clear = this._clear.bind(this);
                    var el = this.container = document.createElement('div');
                    var icon = document.createElement('span');
                    this._inputEl = document.createElement('input');
                    this._inputEl.type = 'text';
                    this._inputEl.placeholder = this.options.placeholder;
                    this._inputEl.addEventListener('keydown', this._onKeyDown);
                    this._inputEl.addEventListener('change', this._onChange);
                    var actions = document.createElement('div');
                    actions.classList.add('geocoder-pin-right');
                    this._clearEl = document.createElement('button');
                    this._clearEl.className = 'geocoder-icon geocoder-icon-close';
                    this._clearEl.setAttribute('aria-label', 'Clear');
                    this._clearEl.addEventListener('click', this._clear);
                    this._loadingEl = document.createElement('span');
                    actions.appendChild(this._clearEl);
                    actions.appendChild(this._loadingEl);
                    el.appendChild(icon);
                    el.appendChild(this._inputEl);
                    el.appendChild(actions);
                    this._typeahead = new Suggestions(this._inputEl, [], {
                        filter: false,
                        minLength: this.options.minLength,
                        limit: this.options.limit
                    });
                    this._typeahead.getItemValue = function (item) { return item.display_name; };
                    return el;
                },
                onRemove: function () {
                    this.container.parentNode.removeChild(this.container);
                    this._map = null;
                    return this;
                },
                _onKeyDown: debounce(function (e) {
                    var target = e.target.shadowRoot ? e.target.shadowRoot.activeElement : e.target;
                    if (!target.value) {
                        return this._clearEl.style.display = 'none';
                    }
                    if (e.metaKey || [9, 27, 37, 39, 13, 38, 40].indexOf(e.keyCode) !== -1) return;
                    if (target.value.length >= this.options.minLength) {
                        this._geocode(target.value);
                    }
                }, 200),
                _onChange: function () {
                    if (this._inputEl.value) this._clearEl.style.display = 'block';
                    var selected = this._typeahead.selected;
                    if (selected && this.options['marker']) {
                        this.options.marker.setLngLat([selected.lng, selected.lat])
                            .addTo(this._map);
                    }
                },
               _geocode: function (searchInput) {
                    var self = this;
                    this._loadingEl.style.display = 'block';
               $.ajax({
                        method: "GET",
                        data: {
                            term: searchInput,
                            limit: self.options.limit
                        },
                        success: function (data) {
                            self._loadingEl.style.display = 'none';
                            self._typeahead.update(data.items);
                        },
                        error: function () {
                            self._loadingEl.style.display = 'none';
                        }
                    });
                },
                _clear: function (ev) {
                    if (ev) ev.preventDefault();
                    this._inputEl.value = '';
                    this._typeahead.selected = null;
                    this._typeahead.clear();
                    this._onChange();
                    this._inputEl.focus();
                    this.options.marker.remove();
                    this._clearEl.style.display = 'none';
                }
            };
            function renderMap() {
                var map_bounds = [
                    [-180.0, -65.0], // Southwest coordinates
                    [180.0, 85.0]
                ];
                var map = new mapboxgl.Map({
                    container: 'timezones-map',
                    style: mapStyleUrl,
                    zoom: 0.9,
                    minZoom: 0.9,
                    center: [0, 30],
                    attributionControl: false,
                    maxBounds: map_bounds
                });
                map.scrollZoom.disable();
                map.dragRotate.disable();
                map.touchZoomRotate.disableRotation();
                var popup = new mapboxgl.Popup({
                    closeButton: false
                });
                var utc_popup = new mapboxgl.Popup({
                    closeButton: false
                });
                var marker = new mapboxgl.Marker({
                    draggable: false
                });
                map.on('load', function () {
                    var expression = ["match", ["get", "tzid"]];
                    var tz_id;
                    for (tz_id in iana_timezone_colors) {
                        expression.push(tz_id, iana_timezone_colors[tz_id]);
                    }
                    expression.push("#f8f8f8");

                    map.addSource('timezones', {
                        "type": "vector",
                        "tiles": ["https://m.24timezones.com/timezone-tiles/{z}/{x}/{y}.mvt"]
                    });
                    map.addLayer({
                        "id": "timezones",
                        "type": "fill",
                        "source": "timezones",
                        "source-layer": "geojsonLayer",
                        "paint": {
                            "fill-color": expression,
                            "fill-opacity": 0.25
                        }
                    });
                    map.addLayer({
                        "id": "timezones-highlighted",
                        "type": "fill",
                        "source": "timezones",
                        "source-layer": "geojsonLayer",
                        "paint": {
                            "fill-color": expression,
                            "fill-opacity": 0.5
                        },
                        "filter": ["==", "offset", ""]
                    });
                    <!-- map.addControl(new SearchCityPlugin({ 'marker': marker }), 'top-left'); -->
                    map.addControl(new mapboxgl.NavigationControl({ showCompass: false }));
                    var throttle = function (func, limit) {
                        var inThrottle;
                        return function () {
                            var args = arguments;
                            var context = this;
                            if (!inThrottle) {
                                func.apply(context, args);
                                inThrottle = true;
                                setTimeout(function () {
                                    inThrottle = false;
                                }, limit);
                            }
                        }
                    };
                    map.on('mousemove', 'timezones', throttle(function (e) {
                        // Change the cursor style as a UI indicator.
                        map.getCanvas().style.cursor = 'pointer';
                        // Single out the first found feature.
                        var feature = e.features[0];
                        var c_time = moment().utcOffset(feature.properties.offset / 60);
                        utc_popup.setHTML(c_time.format('Z'));
                        utc_popup.setLngLat(e.lngLat);
                        utc_popup.addTo(map);
                        map.setFilter('timezones-highlighted', ['==', 'offset', feature.properties.offset]);
                    }, 30));
                    map.on('mouseleave', 'timezones', function () {
                        map.getCanvas().style.cursor = '';
                        utc_popup.remove();
                        map.setFilter('timezones-highlighted', ['==', 'offset', '']);
                    });
                    map.addSource('offset_blocks', {
                        type: 'geojson',
                        data: '/js/data/timezones_map/offsets.json'
                    });
                    var utc_expression = ["match", ['get', 'description']];
                    var utc_offset;
                    for (utc_offset in utc_offset_colors) {
                        utc_expression.push(utc_offset, utc_offset_colors[utc_offset]);
                    }
                    utc_expression.push("#088");
                    map.addLayer({
                        'id': 'offset-blocks',
                        'type': 'fill',
                        'source': 'offset_blocks',
                        'layout': {},
                        'paint': {
                            'fill-color': utc_expression,
                            'fill-opacity': 0.65
                        }
                    });
                    map.addLayer({
                        "id": "offset-block-labels",
                        "type": "symbol",
                        "source": "offset_blocks",
                        "layout": {
                            "text-field": ["get", "description"],
                            // "text-variable-anchor": ["top", "bottom", "left", "right"],
                            "text-justify": "center",
                            'text-font': ['Open Sans Regular']
                        }
                    });
                    map.addSource('cities', {
                        type: 'geojson',
                        data: "/js/data/timezones_map/cities.json"
                    });
                    map.addLayer({
                        "id": "cities",
                        'type': 'circle',
                        "source": "cities",
                        'paint': {
                            // make circles larger as the user zooms from z12 to z22
                            'circle-radius': 3,
                            'circle-color': 'red'
                        }
                    });
                    map.on('click', function (e) {
                        var width = 10;
                        var height = 20;
                        var point = e.point;
                        var features = map.queryRenderedFeatures([
                            [point.x - width / 2, point.y - height / 2],
                            [point.x + width / 2, point.y + height / 2]
                        ], { layers: ['cities'] });

                        if (!features.length) {
                            return;
                        }
                        if (null !== timer_interval) {
                            clearInterval(timer_interval);
                            timer_interval = null;
                        }
                        utc_popup.remove();
                        // Single out the first found feature.
                        var feature = features[0];
                        var updatePopupHtml = function () {
                            var current_time = moment.utc().tz(feature.properties.tz);
                            popup.setHTML("<div><b>" + feature.properties.name + "</b></div>" +
                                "<div>" + current_time.format("MM/DD HH:mm:ss z") + "</div>" +
                                "<div>UTC offset: " + current_time.format("Z") + "</div>"
                            );
                        };
                        popup.setLngLat(e.lngLat);
                        updatePopupHtml(feature);
                        popup.addTo(map);
                        if (null == timer_interval) {
                            timer_interval = setInterval(updatePopupHtml, 1000);
                        }
                    });
                    var onMouseMoveCityLayer = function (e) {
                        // Change the cursor style as a UI indicator.
                        map.getCanvas().style.cursor = 'pointer';
                        if (null !== timer_interval) {
                            clearInterval(timer_interval);
                            timer_interval = null;
                        }
                        utc_popup.remove();
                        // Single out the first found feature.
                        var feature = e.features[0];
                        popup.setLngLat(e.lngLat);
                        var updatePopupHtml = function () {
                            var current_time = moment.utc().tz(feature.properties.tz);
                            popup.setHTML("<div><b>" + feature.properties.name + "</b></div>" +
                                "<div>" + current_time.format("MM/DD HH:mm:ss z") + "</div>" +
                                "<div>UTC offset: " + current_time.format("Z") + "</div>"
                            );
                        };
                        updatePopupHtml();
                        popup.addTo(map);
                        if (null == timer_interval) {
                            timer_interval = setInterval(updatePopupHtml, 1000);
                        }
                    };
                    var onMouseLeaveCityLayer = function (e) {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                        clearInterval(timer_interval);
                        timer_interval = null;
                    };
                    map.on('mousemove', 'cities', onMouseMoveCityLayer);
                    map.on('mouseleave', 'cities', onMouseLeaveCityLayer);
                    map.on('touchstart', 'cities', onMouseMoveCityLayer);
                    map.on('touchcancel', 'cities', onMouseLeaveCityLayer);
                });
            }
            renderMap();
            addScriptOnLoad("/js/search-bundle.min.js?_=1736618872", true, true);